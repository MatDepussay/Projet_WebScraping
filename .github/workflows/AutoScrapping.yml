name: Auto Scraping AutoScout24

on:
  schedule:
    - cron: '15 3 * * *'    # 3h15
    - cron: '45 11 * * *'   # 11h45
    - cron: '30 19 * * *'   # 19h30
  workflow_dispatch:  # Permet de lancer manuellement le workflow

permissions:
  contents: write

jobs:
  scrape:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'
        
    - name: Install Chrome and ChromeDriver
      run: |
        sudo apt-get update
        sudo apt-get install -y wget unzip
        # Installer Chrome
        wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
        sudo dpkg -i google-chrome-stable_current_amd64.deb || sudo apt-get install -f -y
        # VÃ©rifier l'installation
        google-chrome --version
        
    - name: Install Python dependencies
      run: |
        python -m pip install --upgrade pip
        pip install bs4 pydantic requests selenium lxml
        
    - name: Run scraping script
      run: |
        python Scrapping_selenium_autodoc24.py
        
    - name: Commit and push changes
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add annonces_autoscout24.json
        git diff --staged --quiet || git commit -m "ðŸ¤– Auto-scraping: Mise Ã  jour des annonces [$(date '+%Y-%m-%d %H:%M:%S')]"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

